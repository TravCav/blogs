<!DOCTYPE html>

<head>
</head>

<body bgcolor="#808080">

	<canvas id="canvas1"></canvas>
	<canvas id="canvas2"></canvas>
	<script>
		var canvas1 = document.getElementById("canvas1");
		var ctx1 = canvas1.getContext("2d");

		var canvas2 = document.getElementById("canvas2");
		var ctx2 = canvas2.getContext("2d");

		pic1 = new Image();
		pic1.src = 'penguins2.jpg';
		pic1.setAttribute('crossOrigin', '');
		pic1.crossOrigin = "Anonymous";

		pic1.onload = function () {
			canvas1.height = pic1.height;
			canvas1.width = pic1.width;
			ctx1.fillStyle = "blue";
			ctx1.fillRect(0, 0, canvas1.width, canvas1.height);

			ctx1.drawImage(pic1, 0, 0);

			canvas2.height = pic1.height;
			canvas2.width = pic1.width;
			ctx2.fillStyle = "blue";
			ctx2.fillRect(0, 0, canvas2.width, canvas2.height);

			var colorArray = CopyPixels();
			var groups = 8
			kmeans(colorArray, 8);



		};

		function kmeans(colorArray, groupCount) {
			var groupData = [];
			var groups = [];

			for (let index = 0; index < colorArray.length; index++) {
				groupData.push({
					data: colorArray[index],
					group: 0
				});
			}

			// init groups
			for (let index = 0; index < groupCout - 1; index++) {
				groups.push([Math.random() * 255, Math.random() * 255, Math.random() * 255])
			}

			// find closest group 
			for (let index = 0; index < colorArray.length; index++) {
				let dataPoint = colorArray[index].data;

				let distance = 99999;

				for (let groupIndex = 0; groupIndex < groups.length; groupIndex++) {
					var d1 = datapoint[index][1] - groups[groupIndex][1];
					var d2 = datapoint[index][2] - groups[groupIndex][2];
					var d3 = datapoint[index][3] - groups[groupIndex][3];
					var groupDist = Math.sqrt((d1 * d1) + (d2 * d2) + (d3 * d3));
					if (groupDist < distance) {
						distance = groupDist;
						dataPoint.group = groupIndex;
					}
				}
			}

			



		}

		function CopyPixels() {
			var pixelData = ctx1.getImageData(0, 0, canvas1.width, canvas1.height);


			var colors = [];
			for (let index = 0; index < pixelData.length; index += 4) {
				colors.push([pixelData[index], pixelData[index + 1], pixelData[index + 2]]);
			}

			ctx2.putImageData(pixelData, 0, 0);
			return colors;
		};


		// // var img = document.getElementById('my-image');

		// // var canvas = document.getElementById('mycanvas');
		// // var width = img.width;
		// // var height = img.height;
		// // //console.log(width,height);
		// // canvas.width = width;
		// // canvas.height = height;
		// // canvas.getContext('2d').drawImage(img, 0, 0, width, height);

		// // var pixelData = canvas.getContext('2d').getImageData(0, 0, width, height).data;
		// // var pixelValues = [];

		// // for (y = height - 1; y > -1; y--) {
		// // 	for (x = width - 1; x > -1; x--) {
		// // 		var index = x + y * width * 4;
		// // 		pixelValues.push([pixelData[index], pixelData[index + 1], pixelData[index + 2]]);
		// // 		//console.log(pixelData[index],pixelData[index+1],pixelData[index+2]);
		// // 	}
		// // }

		// // canvas.putImageData(pixels, 0, 0);
	</script>
</body>

</html>